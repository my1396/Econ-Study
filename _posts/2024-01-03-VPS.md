---
layout: post
tag: life
title: VPS
---

## **Shadowsocks 科学上网**

1. 购买 VPS 服务器
    <https://www.vultr.com/>
    
    选择套餐
    
    2.5美元/月的服务器配置信息：单核 512M内存 10G SSD硬盘 带宽1G 500G流量/月 (不推荐，仅提供ipv6 ip，不推荐)
    
    3.5美元/月的服务器配置信息：单核 512M内存 10G SSD硬盘 带宽1G 500G流量/月 (推荐)
    
    5美元/月的服务器配置信息： 单核 1G内存 25G SSD硬盘 带宽1G 1000G流量/月 (推荐)

2. 选择服务器系统，Ubuntu 24。

3. 连接 VPS 服务器

   打开 Mac Terminal 输入`ssh root@43.45.43.21` (将45.45.43.21换成你的IP)，之后输入你的密码就可以登录了。

4. Install Shadowsocks-libev Server 

   安装 Shadowsocks 代理。这一步通常叫作“部署服务器端”或者“搭建服务端”。

   有4个常见版本，`-R`, `-Python`, `-Go`, `-libre`。其中 `Shadowsocks-libev` 是目前唯一在持续更新且最为轻量的版本。

   <https://github.com/shadowsocks/shadowsocks-libev?tab=readme-ov-file#build-from-source-with-centos>

   - Ubuntu 16.10 or higher 

     `apt` is a command-line utility for *installing*, updating, removing, and otherwise managing deb packages on *Ubuntu*, Debian, and related Linux distributions.

     ```bash
     # update the package lists
     sudo apt update
     # install shadowsocks-libev
     sudo apt install shadowsocks-libev
     ```

     可以用以下命令来打开配置文件。

     ```
     nano /etc/shadowsocks-libev/config.json
     ```

     意为用 `nano` 这个编辑器打开 `config.json` 这个配置文件。`nano` 是系统自带的软件。如果没有，可以用`sudo apt install` 安装。

     The default contents of the file are as follows.

     ```js
     {
         "server":["::1", "127.0.0.1"],
         "mode":"tcp_and_udp",
         "server_port":8388,
         "local_port":1080,
         "password":"ACRrobo9ymXb",
         "timeout":86400,
         "method":"chacha20-ietf-poly1305"
     }
     ```

     - We need to <span style='color:#32CD32'>change `127.0.0.1` to `0.0.0.0`</span>, so Shadowsocks-libev server will listen on the public IP address. 
     - Then <span style='color:#32CD32'>change `server_port` to other port numbers like 8888</span>. 

     - The password was randomly generated, so you can <u>leave it as it is</u>.

     注意：这里的 `server`, `server_port`, `password` 都与你从 Bandawagon 那里得到的信息不同！这里的信息用户<span style='color:#32CD32'>自定义</span>的，<span style='color:#32CD32'>用于后面配置客户端</span>。 

     **Save and close the file.** Then restart shadowsocks-libev service for the changes to take effect.
     
     ```bash
     sudo systemctl restart shadowsocks-libev.service
     ```

     **Enable auto-start** at boot time.
     
     ```bash
     sudo systemctl enable shadowsocks-libev.service
     ```

     **Check its status**. Make sure it’s running.
     
     ```bash
     sudo systemctl status shadowsocks-libev.service
     ```

     Sample output:
     
     ```bash
     ● shadowsocks-libev.service - Shadowsocks-libev Default Server Service
          Loaded: loaded (/usr/lib/systemd/system/shadowsocks-libev.service; enabled; preset: enabled)
          Active: active (running) since Thu 2024-05-16 07:31:11 UTC; 11s ago
            Docs: man:shadowsocks-libev(8)
        Main PID: 8215 (ss-server)
           Tasks: 1 (limit: 629145)
          Memory: 424.0K (peak: 1.0M)
             CPU: 10ms
          CGroup: /system.slice/shadowsocks-libev.service
                  └─8215 /usr/bin/ss-server -c /etc/shadowsocks-libev/config.json
     ```

5. Install and Configure Shadowsocks-libev Client

   完成Shadowsocks服务端搭建后，我们就需要在本地客户端配置Shadowsocks(R)了，支持iOS、Android手机、Mac、Windows等，其实就是在客户端上填入上一步的连接信息即可。

   <img src="{{site.baseurl}}/images/ss.png" alt="Shadowsocks Client MacOS" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

   Shadowsocks client github page: <https://github.com/shadowsocks>

   Mac users can download [this Shadowsocks client](https://github.com/shadowsocks/ShadowsocksX-NG/releases).

   Next, you need to add a new server in the client software.

   <img src="{{site.baseurl}}/images/add server.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

   **配置服务器—客户端**

   - Specify the 

     - <span style='color:#32CD32'>**server IP address**</span>, 服务器 IP

     - <span style='color:#32CD32'>**server port (8888)**</span>, 服务器端口 and 

     - <span style='color:#32CD32'>**password**</span>. 密码

       This password is the password in the server config file, which is <u>automatically generated</u> during installation.

       Note that it is <span style='color:red'>**NOT** the Root password</span>!

   - You can also change the Timeout value (It should be less than 20 seconds).

   - Leave other settings as default.

   <img src="{{site.baseurl}}/images/server preferences.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

   The client config file will look like this:

   ```js
   {
    "server":"your-server-ip-address",
    "mode":"tcp_and_udp",
    "server_port":8888,
    "local_address":"127.0.0.1",
    "local_port":1080,
    "password":"ACRrobo9ymXb",
    "timeout":60,
    "method":"chacha20-ietf-poly1305"
   }
   ```

   **至此为止，应该可以科学上网了。**

6. Configure web brower proxy access to the internet

    Configure a proxy server as follows:

   - Choose the `SOCKS5` protocol.
   - Set `127.0.0.1` as the server address.
   - Set `1080` as the port number.

   <img src="{{site.baseurl}}/images/proxy preferences.png" alt="Shadowsocks Client MacOS" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

   Firefox

   <img src="{{site.baseurl}}/images/Socks Proxy.webp" alt="Shadowsocks Client MacOS" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />
   
7. Go to [dnsleaktest.com](https://dnsleaktest.com/). You will see your Shadowsocks server’s IP address, which indicates that your proxy is working.



启动 ShadowSocks 服务

```
ss-server -c ~/ss/ss.json -d start
```
Check that Shadowsocks is operating error-free by looking at the service status
```
sudo systemctl status shadowsocks-libev
```
关闭 ShadowSocks 服务
```
ss-server -c ~/ss/ss.json -d stop 
```
重启 ShadowSocks 服务
```
ss-server -c ~/ss/ss.json -d restart
```



启动脚本后面的参数含义，从左至右依次为：启动，停止，重启，查看状态。

Shadowsocks 4 个常见版本：

Shadowsocks-Python 版：
`/etc/init.d/shadowsocks-python start | stop | restart | status`

ShadowsocksR 版：
`/etc/init.d/shadowsocks-r start | stop | restart | status`

Shadowsocks-Go 版：
`/etc/init.d/shadowsocks-go start | stop | restart | status`

Shadowsocks-libev 版：
````
/etc/init.d/shadowsocks-libev start | stop | restart | status
````





配置文件路径：

Shadowsocks-Python 版： `/etc/shadowsocks-python/config.json`

ShadowsocksR 版： `/etc/shadowsocks-r/config.json`

Shadowsocks-Go 版： `/etc/shadowsocks-go/config.json`

Shadowsocks-libev 版：`/etc/shadowsocks-libev/config.json`





如果某天你的 ss 突然无法使用了，很可能就是端口被封了。这时你可以直接在这里，将端口修改为 1-65535 间任意其他数字。

需注意的是，如果你更新了配置文件，得重启 ss 才能生效。重启命令如下

```bash
ss-server -c ~/ss/ss.json -d restart
```





**多用户使用**

有时候需要多个人使用一台服务器，因此我们需要增加端口。

`shadowsocks-libev` 不支持通过简单的修改配置文件来实现。可以用

Q: 如何增加端口？

A: 检测CentOS7是否安装vim，之后要用，没有的话直接安装：

`sudo yum install -y vim`

修改 Shadowsocks 配置文件 (不同版本的路径不一样)，修改成如下形式（“端口”:“密码”）:

`vim /etc/shadowsocks.json`



Install vim on Ubuntu

```bash
sudo apt install vim -y
```

Verify the installation

```bash
vim --version
```





```js
{
    "server":"<your-server-ip>",
    "server_port":<your-port>,      // 端口
    "local_address":"127.0.0.1",
    "local_port":1080,
    "port_password":{
         "9000":"12345",
         "9001":"12345",
         "9002":"12345",
         "9003":"12345",
         "9004":"12345"
    },
    "timeout":300,
    "method":"aes-256-cfb", // 加密方式
    "fast_open": false
}
```







___

**Ping**

ping is a basic debugging step to verify a server is available by sending an ICMP packet and receiving a reply.
The following code pings `192.0.2.22` four times.

```
ping -c 4 192.0.2.22
```

IP check tool

<https://www.vpsgo.com/ip-check-tools.html>

<https://www.toolsdaquan.com/ipcheck/>


检测IP在中国大陆以及海外区域的可用性，端口可以指定为SSH端口，或者任意服务的监听端口。\
Ping是基于ICMP协议的，所以服务器IP能Ping通说明ICMP协议可用；TCP可用说明你这个端口的服务可用，包括SSH，MySQL数据库服务等。

- ICMP不可用：检查服务器是否宕机或者是否禁Ping
- TCP不可用：服务器是否需要手动开放防火墙


<https://github.com/shadowsocks/ShadowsocksX-NG>


【linux重装OS后登录报错】
ECDSA host key for X.X.X.X has changed and you have requested strict checking
当linux重新装机后，其他linux机器ssh访问该服务器时会产生报错，报错信息如下：ECDSA host key for X.X.X.X has changed and you have requested strict checking。

需要执行如下操作更新密钥即可（X.X.X.X为IP地址）：

```
ssh-keygen -R X.X.X.X
```

执行之后即可解决！！！



___

## Bandwagon

Bandwagon homepage: <https://bandwagonhost.com>

Control center: <https://kiwivm.64clouds.com/1966293/main.php>

Client area: <https://bandwagonhost.com/clientarea.php>

Documentation: <https://bandwagonhost.com/kb.php?action=displayarticle&id=30>

依次点击页面上方“Services” $\rightarrow$ “My Services”，然后点击”KiwiVM　Control　Panel“即可进入控制页面。

在进入搬瓦工 KiwiVM后台后，就能看到以下内容，包括搬瓦工SSH IP、端口和一些基本信息。

搬瓦工的SSH用户名是root，而SSH密码会在你购买套餐/重装系统/重置密码后发至你注册时所填的绑定邮箱里。如果没有收到或忘记密码了，可以通过重置密码的方式获取root密码。

1. **查看VPS基本信息**

   最重要的信息为 IP, Root password, SSH port.

   Root password 为登录服务器时使用。没有必要重置。

   如果想要重置，参考以下步骤。

   1. 因为重置密码需要保证VPS开机状态，所以在进行密码重置前我们要格外注意。在搬瓦工实例管理界面，确保VPS状态为”Running“。

      <img src="{{site.baseurl}}/images/BWG.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:100%;" />

   2. 之后选择左侧的”Root password modification“，进入搬瓦工的修改root密码栏目，再点击”Generate and set new root password“就可以修改并设置搬瓦工的ROOT密码了。

      <img src="{{site.baseurl}}/images/root password.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

2. **安装操作系统**

   默认安装Rocky 9x86。选择重新安装服务器系统 。

   注意：重装系统之前，需要关闭当前服务器。

   <img src="{{site.baseurl}}/images/stop VM.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

   Stop your current VM $\rightarrow$ Install new OS $\rightarrow$ Choose Ubuntu 24

   It takes 15 mins to install a new OS.

   <img src="{{site.baseurl}}/images/ubuntu.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

   The system begins the installation. Make sure to save the Root Password shown. 

3. **登录服务端，连接VPS**

   二选一，可以从 KiwiVM 或者 Mac 登录。

   - KiwiVM

     Talking to VPS via  `Root Shell – Basic`.  Don't need to log in. Can type cmds directly.

     Talking to VPS via  `Root Shell – Interactive`.  This is a fully interactive shell, similar to a standard PuTTY client.  Must log in to type cmds. ❌

     <img src="{{site.baseurl}}/images/interactive shell.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

     

     **How to log in Root Shell Interactive?**

     Type in word: `root` and press `Enter`.

     Root passwrod is required. Now go ahead and type it in. 

     > Note, you cannot Copy & Paste anything in Linux... So the password is to be entered manually (make sure to respect the Upper case letters). In addition, as you type in the password, it won't be show on the screen, kind of blind typing.. Once finished, press [Enter].

     <img src="{{site.baseurl}}/images/Kiwi Shell.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

     

   - Mac ✅

     打开 <u>Mac Terminal</u> 输入`ssh root@43.45.43.21` (将 `45.45.43.21` 换成你的 IP)

     屏幕上会出现一连串提示如下

     ```bash
     The authenticity of host '97.64.81.187 (97.64.81.187)' can't be established.
     ED25519 key fingerprint is SHA256:JYmUQrTJOts6jTU2sMMGzdsgtuyNnMZfwN5e9TeJ/oI.
     This key is not known by any other names.
     Are you sure you want to continue connecting (yes/no/[fingerprint])? 
     ```

     意为无法确认 host 主机的真实性，只知道它的公钥指纹，问你还想继续连接吗？直接输入 `yes` 并回车。

     之后输入Root Passwrod 并回车。

     <img src="{{site.baseurl}}/images/Mac connet to server.png" alt="Bandawagon" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />

     当屏幕出现`[root@nice-cluster-4 ~]#` 时，说明已成功登录，以后再登录 ssh 时就不会出现公钥指纹提示了。
     
     - Mac Terminal 的方便之处在于可以 copy & paste.
     
     - 重装系统后，会出现登录错误。删除 `/.ssh/known_hosts` 之后，重新登录即可。

4. **配置Shadowsocks 服务器端**

   检查和配置 Shadowsocks

   ```bash
   /etc/init.d/shadowsocks-libev status
   ```

   

5. **安装Shadowsocks 客户端**



___

## FAQ

Q: How to exit SSH connection?

A: type `exit` and hit Enter.



Q: How to set up IOS (i.e., iPhone and iPad) for Shadowsocks?

A: What you need is a VPN Internet network proxy manager, act as VPN <span style='color:#32CD32'>proxy client (客户端的代理设置)</span>. A proxy client set up proxy for you, it is different from a proxy service provider. You need to have your own server information, and then set up proxy using the client.

Free options: iPhone can be set by `V2BOX – V2ray Client`. iPad can be set by `Jamjams`.

Charged options: `Shadowrocket` for iPhone (40 kr).



Q: Proxy Client 的参数

A: Which proxy protocols it supports, such as Shadowsocks, V2ray, Vmess, Trojan, SSH, Socks. Which encryption protocol it supports, such as `AES-128(192 OR 256)-GCM`, `Chacha20-IETF`, `Chacha20-ietf-poly1305`, `xchacha20 ietf -- poly1305`.



___

### VPN Provider

[SecureVPN](https://www.securevpn.pro/eng/setup/ios-shadowsocks-vpn)

[ProxySocks5](https://proxysocks5.com/blog/tutorial/ios-how-to-setup-shadowsocks/)







___

参考教程：

<https://www.linuxbabe.com/ubuntu/shadowsocks-libev-proxy-server-ubuntu-24-04>

<https://turboyu.github.io/post/ke-xue-shang-wang-de-zheng-que-zi-shi-zai-vultr-vps-shang-da-jian-shadowsocks/>

<https://bobcares.com/blog/vultr-vps-shadowsocks/>

<https://github.com/bwgvps/bwgvps.github.io>

<https://turboyu.github.io/post/ke-xue-shang-wang-de-zheng-que-zi-shi-zai-vultr-vps-shang-da-jian-shadowsocks/>